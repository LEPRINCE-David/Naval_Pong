<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>ValanGonp</title>
        <style>
            body { margin: 0; overflow-x: hidden; color: #ffffff; }
            canvas { width: 100%; height: 100%; display: block; ;}
            .line1 {
                fill: green;
                stroke: black;
                stroke-width: 1.5px;
                opacity:0.5;
            } 
            .imageIntro {
                width: 101%;
                height: auto;
                position: absolute;
            }
            .titreIntro {
                position: absolute;
                margin-left: 20%;
                text-decoration: line-through;
                font-size: 25px;
                font-family: "Courier New", Courier, monospace;
            }
            .titreIntro2 {
                position: absolute;
                margin-left: 55%;
                font-size: 25px;
                font-family: "Courier New", Courier, monospace;
            }
            .titreIntro3 {
                position: absolute;
                margin-left: 45%;
                margin-top: 6%;
                text-decoration: underline;
                text-shadow: 1px 1px black;
                font-size: 31px;
                font-weight: bold;
                font-family: "Comic Sans MS", cursive, sans-serif;
            }
            .textIntro {
                position: absolute;
                margin-left: 5%;
                margin-top: 30%;
                font-size: 14px;
                font-family: "Courier New", Courier, monospace;
            }

            .boutonNavalPong {
                display: inline-block;
                position: absolute;
                padding: 15px 25px;
                font-size: 24px;
                cursor: pointer;
                text-align: center;
                text-decoration: none;
                outline: none;
                color: #fff;
                background-color: #0044FE;
                border: none;
                border-radius: 15px;
                box-shadow: 0 9px #999;
                margin-left: 15%;
                margin-top: 60%;
            }

            .boutonNavalPong:hover {background-color: #0535B9}

            .boutonNavalPong:active {
                background-color: #5DB4F7;
                box-shadow: 0 5px #666;
                transform: translateY(4px);
            }

            .boutonNavalPong:disabled {
                background: #ffffff;
            }

            .boutonClassicPong {
                display: inline-block;
                position: absolute;
                padding: 15px 25px;
                font-size: 24px;
                cursor: pointer;
                text-align: center;
                text-decoration: none;
                outline: none;
                color: #fff;
                background-color: #272727;
                border: none;
                border-radius: 15px;
                box-shadow: 0 9px #999;
                margin-left: 55%;
                margin-top: 60%;
            }
            .boutonClassicPong:hover {background-color: #000000}

            .boutonClassicPong:active {
                background-color: #111111;
                box-shadow: 0 5px #666;
                transform: translateY(4px);
            }

            .boutonClassicPong:disabled {
                background: #ffffff;
            }

            .defaite {
                display: inline-block;
                position: absolute;
                margin-left: 41%;
                margin-top: 1%;
                text-shadow: 1px 1px white;
                color: red;
                font-size: 31px;
                font-weight: bold;
                font-family: "Comic Sans MS", cursive, sans-serif;
            }

            .lancement {
                display: inline-block;
                position: absolute;
                margin-left: 43%;
                margin-top: 1%;
                text-shadow: 1px 1px white;
                font-size: 31px;
                font-weight: bold;
                font-family: "Comic Sans MS", cursive, sans-serif;
            }

            .mute {
                display: inline-block;
                position: absolute;
                padding: 15px 25px;
                font-size: 12px;
                cursor: pointer;
                text-align: center;
                text-decoration: none;
                outline: none;
                color: #272727;
                background-color: #fff;
                border: none;
                border-radius: 15px;
                margin-left: 0%;
            }
        </style>
    </head>
    <body>
        <div id=intro>
            <img class="imageIntro" src="../medias/images/intro-afterEnd.png" alt="ImageIntro">
            <p class="titreIntro">
            Objet : Déclaration de ??????
            </p>
            <p class="titreIntro2">
            Accords de la Mer Sans Nom
            </p>
            <p class="titreIntro3">
            ValanGonp
            </p>
            <p class="textIntro">
            XXXXX,<br/><br/>
            .n .--_. a attaqué !<br/><br/>
            Sauvez-._-. |?/§?\<br/><br/>
            vhS4kYbRw0ybBEnzOuQaXbj2bqp3Yytoo3LZaCOyIkMeqGR<br/>JUmSoZi9oagUhpunNXxIFbJHeFOHdliysLgRovMm9WJjiJt7BKIIIMV6dHR0SDaSocihbG9hZxhZOuAIE10TbPxlvvOWWYP7
            kjdFYFIT0CSnnYvpXWeSTVUnyBuKmuHmYGQ4VgHOWr5SwWwfIylfc611i7MBHFxBBLnYERqufMBzoz9sQX8919AHgZi2JNZPXjGn3TDmJHNkkggqHXasctV0kxw2<br/>t9vITYPpgenN
            1IOFXUYNsDkI8eESeHGhNBuSFsGpI9K76wtNBy1UZbUNBjJfOY2bg4<br/><br/>CsU2XMgvvhrxaHZDZS6asQuxyyELLl0PY16oWT6NCpn0mLKOPIJxJRWlHfVsNFpIn7iqqKZb4lAqsAVM4Ewufx
            DVfUpIlGLy5D88aBN2aWtkmJkgi7qfKBCPuc5wIprC8ZVyX5jAXOF8dqGnquQmPDfkzKaksBl0u4Po97ZB56pyS<br/>45BFAatEIRp2G67SHUjob9ZdxqkwmOlsDyaoSRNdqEUh8LWEXgSk6
            Ma0WtCSMcSIJ8zdMatK6nZGY5wzIqd4RW7wzriC5XGgNRibBc730YyUMiDZhb4Es5ev2DCiQQQV0p7alv266GJ0JH9QOnd0JhrMVPeNe6tACq9Xv6y6TZHErUvW4sOIVyBI3FusVmU2m
            XYhoIL5Y3VNLoC5C8Fl8OQaNSbKDkWZRwJx8jq7b7oy3fTnLIEsR58So87eyqBb13Ga8j72Hgsg2UPIjWyh3Ep4<br/><br/>10M10vg6DHpTA5R5xNrGm4dwNc6fpGL69<br/>Ite59JAxlPkD0hYP7sdeblW3NnuDq2PSAVNSfFNw8xCJzssqmOD1<br/>KHCX8dq5sYKgva85CeaZDNEqDvgQcGDaKPYlbkb7PJqQi5qCvclA9yTKzA8cFTaVmx8lk99YdRXjJDPSoqttNFDFbG3Tp0xySV9aZPsZcxwFh6x5
            nnZ2uVtLjBONIDZT
            </p>

            <button id="lancerNavalPong" class="boutonNavalPong" disabled>Retourner sauver le monde</button>

            <button id="lancerClassicPong" class="boutonClassicPong" onclick="self.location.href='classic-afterEnd.html'" disabled>Essayer de profiter de sa retraite</button>

            <script>document.getElementById("lancerNavalPong").onclick = function () {
            document.getElementById('intro').innerHTML = '';
            document.getElementById('all').setAttribute("overflow-y", "hidden");
            document.getElementById('messageLancement').innerHTML = 'Appuyez sur L';
            var sound = new Howl({
              urls: ['../medias/sounds/canon.mp3'],
              volume: 0.5
            }).play();};
            </script>
        </div>

        <button id="mute" class="mute">Mute</button>
        <script>document.getElementById("mute").onclick = function () {if (mute == false) {mute=true;Howler.mute();document.getElementById('mute').innerHTML = 'UnMute';}else {mute=false;Howler.unmute();document.getElementById('mute').innerHTML = 'Mute';}};
        </script>
        
        <div id="all">
        <div id="defaite" class="defaite">
        </div>
            <p id=messageLancement class="lancement">
            </p>

        <script src="../js/three.js"></script>
        <script src="../js/dat.gui.min.js"></script>
        <script src="../js/stats.js"></script>
        <script src='../js/THREEx.FullScreen.js'></script>
        <script src="../js/water-material.js"></script>
        <script src="../js/mirror.js"></script>
        <script src="../js/window.js"></script>
        <script src="../js/OrbitControls.js"></script>
        <script src="../js/howler.js"></script>
        <script src="../passes/EffectComposer.js"></script>
        <script src="../passes/CopyShader.js"></script>
        <script src="../passes/RenderPass.js"></script>
        <script src="../passes/ShaderPass.js"></script>
        <script src="../passes/HorizontalTiltShiftShader.js"></script>
        <script>
            // Variables
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 20000);
            var composer;
            var postProcess = false;
            //var controls = new THREE.OrbitControls(camera);
            var helico = new THREE.Object3D();
            var helicoE = new THREE.Object3D();
            var loader = new THREE.JSONLoader();
            var contour = new THREE.Object3D();
            var contour_v = new THREE.Object3D();
            var contour_h = new THREE.Object3D();

            music();
            var mute = false;

            var Ball, Balle;
            var Bateau2, Bateau4;
            var baseE, baseP;
            var outlineMesh1, outlineMesh2, outlineMesh3, outlineMesh4, outlineMesh5;
            var sea;
            var Seagull, Shark, Whale;
            var bouee;
            var Line;
            var quadri;
            var bouees1, bouees2, bouees3, bouees4;
            var BoardP;
            var BoardE;
            var drapeauSprite;
            var contour_v, contour_h;
            var particleSystemP, particleSystemE;
            var circleP, circleE, circlePJoker, arrow1, arrow2, arrowL, arrowR, aiguille;
            var aiguilleX, aiguilleY;
            var BallposX, BallposY;
            var BallMovX = 0;
            var BallMovY = 0;
            var houleZ = 0;
            var houleX = 0;
            var run = 0;
            var MouseX, MouseY;
            var launch = 0;
            var sprite;
            var camHelico = false;
            var camMouette = false;
            var coeffVitBall = 1;
            var pleinEcran = false;
            var explosion = false;

// gestion qualite
            var lowquality = "true";
            var changequality = false;
            var bouees = "false";
            var changeBouees = false;
            var options = new THREE.Object3D();
            var barresBut = new THREE.Object3D();
            var boueesAlt = new THREE.Object3D();
            var vueAerienne = false;
            var spriteMap = new THREE.TextureLoader().load("../medias/images/pirateLogo.png");
            spriteMap.wrapS = THREE.RepeatWrapping;
            spriteMap.repeat.x = - 1;
            var spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var pirateSprite = new THREE.Sprite( spriteMaterial );
            spriteMap = new THREE.TextureLoader().load("../medias/images/helicopterSPrite.png");
            spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var ennemiSprite = new THREE.Sprite( spriteMaterial );
            ennemiSprite.scale.set(1.5, 1.5, 1.5);
            ennemiSprite.position.z = 2;
            spriteMap = new THREE.TextureLoader().load("../medias/images/unSprite.png");
            spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var unSprite = new THREE.Sprite( spriteMaterial );
            spriteMap = new THREE.TextureLoader().load("../medias/images/unSprite.png");
            spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var unSpriteE = new THREE.Sprite( spriteMaterial );
            spriteMap = new THREE.TextureLoader().load("../medias/images/deuxSprite.png");
            spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var deuxSprite = new THREE.Sprite( spriteMaterial );
            spriteMap = new THREE.TextureLoader().load("../medias/images/deuxSprite.png");
            spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
            var deuxSpriteE = new THREE.Sprite( spriteMaterial );
            

// gestion bonus
            var bonus1 = new THREE.Object3D();
            var bonus2 = new THREE.Object3D();
            var bonus3 = new THREE.Object3D();
            var arbreBonusTerrain = false;
            var arbreBonus = false;
            var ssMarinBonusTerrain = true;
            var ssMarinBonus = false;
            var submarine;
            var submarineJoker;
            var invincible = false;

// gestion manches
            var scoreJoueur = 0;
            var scoreEnnemi = 0;
            var changementManche = false;
            var niveau = 1;
            var changementNiveau = false;
            var paperBoatScore  = new THREE.Object3D();
            var paperBoatScoreLow  = new THREE.Object3D();
            var gagnant = "";

// pv bateaux
            var pvBoat2 = 2;
            var pvBoat2E = 2;
            var pvBoat4 = 4;
            var pvBoat4E = 4;

// Deplacement joueur
            var PlayerDeplac = "nul";
            var haut = "nul";
            var hautI = 0;
            var bas = "nul";
            var basI = 0;
            var gauche = "nul";
            var gaucheI = 0;
            var droite = "nul";
            var droiteI = 0;
            var inertie = true;

// Gestion ennemi
            var EnemyDeplac = "nul";
            var hautE = "nul";
            var hautIE = 0;
            var basE = "nul";
            var basIE = 0;
            var gaucheE = "nul";
            var gaucheIE = 0;
            var droiteE = "nul";
            var droiteIE = 0;
            var puissanceEnnemi = 1.3;
            var coeffVitHelicoE = 1.1;


// gestion deplacement balle
            var directionY = 1;
            var directionX = 1;

// gestion collision
            var cooldown = 0;
            var toucheP = 0;
            var toucheE = 0;
            var toucheESuper = 0;
            var toucheCollision = 0;

// gestion post-process
            var pass1 = new THREE.ShaderPass(THREE.HorizontalTiltShiftShader);


            var renderer;

// Voir les fps
            /*var stats = new Stats();
            stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
            document.body.appendChild(stats.dom);*/
            var lastLoop = new Date;
            var fps = 0;


            function initScene() {
                renderer = new THREE.WebGLRenderer({alpha: true, antialias: true, preserveDrawingBuffer: true}); // alpha: true pour fond blanc
                renderer.setSize(window.innerWidth, window.innerHeight, true);
                document.body.appendChild(renderer.domElement);

// Composer
                composer = new THREE.EffectComposer(renderer);

// Passes
                var renderPass = new THREE.RenderPass(scene, camera);
                composer.addPass(renderPass);

                pass1.renderToScreen = true;
                pass1.uniforms['tDiffuse'].value = 1;
                composer.addPass(pass1);
            }


// Initialisation des lumières
            function initLight() {
                var light = new THREE.PointLight(0xFFFFFF);
                light.position.set(10, 0, 30);
                scene.add(light);
            }


            function initGeometry() {
// Creation de la balle
                Balle = new THREE.Object3D();

                sphereGeometry2 = new THREE.SphereGeometry(0.2, 50, 50, 0, Math.PI * 2, 0, Math.PI * 2);
                material = new THREE.MeshBasicMaterial({color: 0x000000});
                Ball = new THREE.Mesh(sphereGeometry2, material);
                Ball.position.set(-11.5, 0, 1);
                //Pour les tests
                //Ball.position.set(2, -12, 1);
                Ball.material.transparent = true;
                Ball.material.opacity = 0.7;

                Balle.add(Ball);



// Creation des particules du cercle du joueur
                var particleCount = 31;
                var particles = new THREE.Geometry();
                var particle_Material = new THREE.PointsMaterial({
                color: 0x0FFFFFF,
                size: 0.1
                });
                var min = -10,
                max = 10;
                // Create the individual particles
                for (var i = 0; i < particleCount; i++) {
                var radius = 0.7;
                var random = Math.random();
                var variance = Math.random();
                var max = 10,
                    min = -10;
                //radius += (Math.floor(variance * (max - min + 1)) + min);
                var pX = radius * Math.sin(random * (2 * Math.PI)),
                    pY = radius * Math.cos(random * (2 * Math.PI)),
                    pZ = 1;
                var particle = new THREE.Vector3(
                                    pX,pY,pZ
                                );
                particle.velocity = new THREE.Vector3(
                                        0,
                                        -Math.random(),
                                        0
                                    );
                // Add the particle to the geometry
                particles.vertices.push(particle);
                }
                // Create the particle system
                particleSystemP = new THREE.Points(
                                        particles,particle_Material
                                    );
                particleSystemP.sortParticles = true;

                particleSystemP.name = "PartyCules";
                // Add the particle system to the scene
                scene.add(particleSystemP);


                var radius   = 0.7,
                segments = 64,
                material = new THREE.LineBasicMaterial( { color: 0x0000ff } ),
                geometry = new THREE.CircleGeometry( radius, segments );

                // Remove center vertex
                geometry.vertices.shift();
                circleP = new THREE.Line( geometry, material );
                circleP.position.z = 1;
                circleP.name = "Player";

                scene.add( circleP );


// Creation des particules du cercle ennemi
                var particleCount = 66;
                var particles = new THREE.Geometry();
                var particle_Material = new THREE.PointsMaterial({
                color: 0x000000,
                size: 0.2
                });
                var min = -10,
                max = 10;
                // Create the individual particles
                for (var i = 0; i < particleCount; i++) {
                var radius = 1;
                var random = Math.random();
                var variance = Math.random();
                var max = 10,
                    min = -10;
                //radius += (Math.floor(variance * (max - min + 1)) + min);
                var pX = radius * Math.sin(random * (2 * Math.PI)),
                    pY = radius * Math.cos(random * (2 * Math.PI)),
                    pZ = 1;
                var particle = new THREE.Vector3(
                                    pX,pY,pZ
                                );
                particle.velocity = new THREE.Vector3(
                                        0,
                                        -Math.random(),
                                        0
                                    );
                // Add the particle to the geometry
                particles.vertices.push(particle);
                }
                // Create the particle system
                particleSystemE = new THREE.Points(
                                        particles,particle_Material
                                    );
                particleSystemE.sortParticles = true;

                particleSystemE.name = "PartyCules";
                // Add the particle system to the scene
                scene.add(particleSystemE);


                var radius   = 1,
                segments = 64,
                material = new THREE.LineBasicMaterial( { color: 0xff0000 } ),
                geometry = new THREE.CircleGeometry( radius, segments );

                // Remove center vertex
                geometry.vertices.shift();
                circleE = new THREE.Line( geometry, material );
                circleE.position.z = 1;
                circleE.name = "Enemy";

                scene.add( circleE );

// Creation de la boussole sous le joueur

                aiguille = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.1), new THREE.MeshBasicMaterial({color: 0xff0000}));
                aiguille.position.set(helico.position.x, helico.position.y, 1);
                aiguille.rotation.z = 0;
                scene.add(aiguille);

//Creation effets sur la balle

                var sphereGeometry = new THREE.SphereGeometry(0.2, 50, 50);

                var outlineMaterial1 = new THREE.MeshBasicMaterial( { color: 0xff0000, side: THREE.BackSide } );
                outlineMesh1 = new THREE.Mesh( sphereGeometry, outlineMaterial1 );
                outlineMesh1.position = Ball.position;
                outlineMesh1.scale.multiplyScalar(1.1);
                outlineMesh1.material.transparent = true;
                Balle.add( outlineMesh1 );

                var outlineMaterial2 = new THREE.MeshBasicMaterial( { color: 0xff5a00, side: THREE.BackSide } );
                outlineMesh2 = new THREE.Mesh( sphereGeometry, outlineMaterial2 );
                outlineMesh2.position = Ball.position;
                outlineMesh2.scale.multiplyScalar(1.2);
                outlineMesh2.material.transparent = true;
                Balle.add( outlineMesh2 );

                var outlineMaterial3 = new THREE.MeshBasicMaterial( { color: 0xff9a00, side: THREE.BackSide } );
                outlineMesh3 = new THREE.Mesh( sphereGeometry, outlineMaterial3 );
                outlineMesh3.position = Ball.position;
                outlineMesh3.scale.multiplyScalar(1.3);
                outlineMesh3.material.transparent = true;
                Balle.add( outlineMesh3 );

                var outlineMaterial4 = new THREE.MeshBasicMaterial( { color: 0xffce00, side: THREE.BackSide } );
                outlineMesh4 = new THREE.Mesh( sphereGeometry, outlineMaterial4 );
                outlineMesh4.position = Ball.position;
                outlineMesh4.scale.multiplyScalar(1.4);
                outlineMesh4.material.transparent = true;
                Balle.add( outlineMesh4 );

                var outlineMaterial5 = new THREE.MeshBasicMaterial( { color: 0xffe808, side: THREE.BackSide } );
                outlineMesh5 = new THREE.Mesh( sphereGeometry, outlineMaterial5 );
                outlineMesh5.position = Ball.position;
                outlineMesh5.scale.multiplyScalar(1.5);
                outlineMesh5.material.transparent = true;
                Balle.add( outlineMesh5 );

                scene.add(Balle);
                Ball.material.opacity = 0;
                outlineMesh1.material.opacity = 0;
                outlineMesh2.material.opacity = 0;
                outlineMesh3.material.opacity = 0;
                outlineMesh4.material.opacity = 0;
                outlineMesh5.material.opacity = 0;


// Ajout des nuages
                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                var cloud = new THREE.Mesh(new THREE.PlaneGeometry(1171,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.position.y = 1100;
                cloud.position.z = 200;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);

                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG2.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                cloud = new THREE.Mesh(new THREE.PlaneGeometry(1171,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.rotation.y = -Math.PI / 2;
                cloud.position.x = 1000;
                cloud.position.y = -100;
                cloud.position.z = 250;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);

                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG3.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                var cloud = new THREE.Mesh(new THREE.PlaneGeometry(916,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.rotation.y = -Math.PI / 4;
                cloud.position.x = 900;
                cloud.position.y = 900;
                cloud.position.z = 200;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);

                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG4.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                var cloud = new THREE.Mesh(new THREE.PlaneGeometry(916,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.rotation.y = -Math.PI;
                cloud.position.x = -500;
                cloud.position.y = -900;
                cloud.position.z = 150;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);

                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG5.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                var cloud = new THREE.Mesh(new THREE.PlaneGeometry(916,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.rotation.y = Math.PI / 2;
                cloud.position.x = -900;
                cloud.position.z = 200;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);

                texture = THREE.ImageUtils.loadTexture('../medias/images/cloud_PNG6.png'),
                material = new THREE.MeshBasicMaterial({map: texture});
                var cloud = new THREE.Mesh(new THREE.PlaneGeometry(916,500), material);
                cloud.rotation.x = Math.PI / 2;
                cloud.rotation.y = Math.PI / 4;
                cloud.position.x = -800;
                cloud.position.y = 800;
                cloud.position.z = 150;
                cloud.material.transparent = true;
                cloud.material.opacity = 1;
                scene.add(cloud);


// Ajout quadrillage
                quadri = new THREE.Object3D();
                material = new THREE.LineBasicMaterial({color: 0x000000});

                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 6,  0.01));
                line.vertices.push(new THREE.Vector3(-8, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-6, 6,  0.01));
                line.vertices.push(new THREE.Vector3(-6, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-4, 6,  0.01));
                line.vertices.push(new THREE.Vector3(-4, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-2, 6,  0.01));
                line.vertices.push(new THREE.Vector3(-2, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(0, 6,  0.01));
                line.vertices.push(new THREE.Vector3(0, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(2, 6,  0.01));
                line.vertices.push(new THREE.Vector3(2, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(4, 6,  0.01));
                line.vertices.push(new THREE.Vector3(4, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(6, 6,  0.01));
                line.vertices.push(new THREE.Vector3(6, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(8, 6,  0.01));
                line.vertices.push(new THREE.Vector3(8, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 6,  0.01));
                line.vertices.push(new THREE.Vector3(8, 6, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 8,  0.01));
                line.vertices.push(new THREE.Vector3(8, 8, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 10,  0.01));
                line.vertices.push(new THREE.Vector3(8, 10, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 12,  0.01));
                line.vertices.push(new THREE.Vector3(8, 12, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 14,  0.01));
                line.vertices.push(new THREE.Vector3(8, 14, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 16,  0.01));
                line.vertices.push(new THREE.Vector3(8, 16, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 18,  0.01));
                line.vertices.push(new THREE.Vector3(8, 18, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 20,  0.01));
                line.vertices.push(new THREE.Vector3(8, 20, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, 22,  0.01));
                line.vertices.push(new THREE.Vector3(8, 22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);

                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -6,  0.01));
                line.vertices.push(new THREE.Vector3(-8, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-6, -6,  0.01));
                line.vertices.push(new THREE.Vector3(-6, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-4, -6,  0.01));
                line.vertices.push(new THREE.Vector3(-4, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-2, -6,  0.01));
                line.vertices.push(new THREE.Vector3(-2, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(0, -6,  0.01));
                line.vertices.push(new THREE.Vector3(0, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(2, -6,  0.01));
                line.vertices.push(new THREE.Vector3(2, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(4, -6,  0.01));
                line.vertices.push(new THREE.Vector3(4, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(6, -6,  0.01));
                line.vertices.push(new THREE.Vector3(6, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(8, -6,  0.01));
                line.vertices.push(new THREE.Vector3(8, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -6,  0.01));
                line.vertices.push(new THREE.Vector3(8, -6, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -8,  0.01));
                line.vertices.push(new THREE.Vector3(8, -8, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -10,  0.01));
                line.vertices.push(new THREE.Vector3(8, -10, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -12,  0.01));
                line.vertices.push(new THREE.Vector3(8, -12, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -14,  0.01));
                line.vertices.push(new THREE.Vector3(8, -14, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -16,  0.01));
                line.vertices.push(new THREE.Vector3(8, -16, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -18,  0.01));
                line.vertices.push(new THREE.Vector3(8, -18, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -20,  0.01));
                line.vertices.push(new THREE.Vector3(8, -20, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);
                line = new THREE.Geometry();
                line.vertices.push(new THREE.Vector3(-8, -22,  0.01));
                line.vertices.push(new THREE.Vector3(8, -22, 0.01));
                Line = new THREE.Line(line, material);
                quadri.add(Line);

                quadri.position.z = -0.1;
                quadri.visible = true;
                scene.add(quadri);


// Ajout des bases joueur/ennemi
                loader.load('../medias/models/baseE.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    baseE = new THREE.Mesh( geometry, material );
                    baseE.name = "BaseE";
                    baseE.scale.set(1.1,1.1,1.1);
                    baseE.rotation.x = Math.PI / 2;
                    baseE.position.set(-2, 25, -0.5);
                    options.add(baseE);
                    //scene.add(options);
                });

                var outlineMaterial6 = new THREE.MeshBasicMaterial( { color: 0xaa0000 } );
                cube = new THREE.BoxGeometry(16.1, 0.5, 0.01);
                var barre = new THREE.Mesh( cube, outlineMaterial6 );
                barre.position.set(0, 23, 0.09);
                barre.name = "Ligne Base Ennemie";
                barresBut.add(barre);
                scene.add(barresBut);

                loader.load('../medias/models/baseP.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    baseP = new THREE.Mesh( geometry, material );
                    baseP.name = "BaseP";
                    baseP.scale.set(0.8,0.8,0.8);
                    baseP.rotation.x = Math.PI / 2;
                    baseP.rotation.y = -Math.PI / 2;
                    baseP.position.set(5, -30, 1.2);
                    options.add(baseP);
                    //scene.add(options);
                });

                var outlineMaterial6 = new THREE.MeshBasicMaterial( { color: 0x0000aa } );
                cube = new THREE.BoxGeometry(16.1, 0.5, 0.01);
                var barre = new THREE.Mesh( cube, outlineMaterial6 );
                barre.position.set(0, -23, 0.09);
                barre.name = "Ligne Base Joueur";
                barresBut.add(barre);
                scene.add(barresBut);


// Ajout du bateau pirate
                loader.load('../medias/models/perla.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    pirate = new THREE.Mesh( geometry, material );
                    pirate.name = "Bateau Pirate";
                    pirate.scale.set(1.1,1.1,1.1);
                    pirate.rotation.x = Math.PI / 2 - 0.1;
                    pirate.position.set(-13, 0, 0.3);
                    options.add(pirate);
                    //scene.add(options);
                });
                pirateSprite.scale.set(12, 7.63, 10);
                pirateSprite.position.set(-15,-1,3);
                scene.add(pirateSprite);


// Ajout des helicos (joueur/ennemi)
                helico1 = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), material); // Initialiser helico
                helico2 = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), material); // Initialiser helico

                helicoE1 = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), material);
                helicoE2 = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), material);

                loader.load('../medias/models/helico.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    helico1 = new THREE.Mesh( geometry, material );
                    helico1.name = "helico";
                    helico1.scale.set(0.2,0.2,0.2);
                    //helico.rotation.x = Math.PI / 2 - 0.1;
                    helico1.position.set(0,0,1.5);
                    helico.add(helico1);
                });

                loader.load('../medias/models/helico2.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    helico2 = new THREE.Mesh( geometry, material );
                    helico2.name = "helico";
                    helico2.scale.set(0.2,0.2,0.2);
                    //helico.rotation.z = Math.PI/2;
                    helico2.position.set(0,0,1.5);
                    helico.add(helico2);
                });

                scene.add(helico); // helico du joueur

                loader.load('../medias/models/helicoE_.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    helicoE1 = new THREE.Mesh( geometry, material );
                    helicoE1.name = "helico ennemi";
                    helicoE1.scale.set(0.4,0.4,0.4);
                    //helicoE1.rotation.z = Math.PI;
                    helicoE1.position.set(0,0,2);
                    helicoE.add(helicoE1);
                });

                loader.load('../medias/models/helicoE2.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    helicoE2 = new THREE.Mesh( geometry, material );
                    helicoE2.name = "helico ennemi";
                    helicoE2.scale.set(0.4,0.4,0.4);
                    //helicoE2.rotation.z = Math.PI;
                    helicoE2.position.set(0,0,2);
                    helicoE.add(helicoE2);
                });

                helicoE.position.set(-6,8,0);

                scene.add(ennemiSprite);


// Divers ajout pour l'environnement
                loader.load('../medias/models/seagull.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    Seagull = new THREE.SkinnedMesh( geometry, material );
                    Seagull.name = "Mouette";
                    Seagull.rotation.x = Math.PI/2;
                    Seagull.rotation.y = 0;
                    Seagull.position.set(0,0,5);
                    scene.add(Seagull);
                });


                loader.load('../medias/models/shark.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    Shark = new THREE.Mesh( geometry, material );
                    Shark.name = "Requin";
                    Shark.rotation.x = Math.PI/2;
                    Shark.rotation.y = Math.PI/2;
                    Shark.position.set(-40,0,-1);
                    if (Math.random() < 0.5) {
                        Shark.position.y = 5;
                    }
                    else {Shark.position.y = -5}
                    options.add(Shark);
                });

// Ajout des bouees
                var barre = new THREE.Mesh(new THREE.BoxGeometry(0.5, 46.2, 0.01), new THREE.MeshBasicMaterial({ color: 0x000000 }));
                barre.position.set(9, 0, 0.09);
                boueesAlt.add(barre);
                var barre = new THREE.Mesh(new THREE.BoxGeometry(0.5, 46.2, 0.01), new THREE.MeshBasicMaterial({ color: 0x000000 }));
                barre.position.set(-9, 0, 0.09);
                boueesAlt.add(barre);

                scene.add(boueesAlt);
                // 4 différents types de bouees pour une gestion de houle plus realiste
                bouees1 = new THREE.Object3D();
                bouees2 = new THREE.Object3D();
                bouees3 = new THREE.Object3D();
                bouees4 = new THREE.Object3D();
                // Pas de boucle parce que l'incrémentation du variables temporaire prendrait effet de suite alors que le chargement des modèles arrivent en fin -> Tout les modèles se chargent quand la variable à atteint sa valeur finale et se retrouvent ainsi au meme emplacement

            // PARTIE GAUCHE
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-22,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-20,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-18,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-16,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-14,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-12,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-10,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-8,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-6,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-4,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,-2,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,0,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,2,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,4,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,6,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,8,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,10,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,12,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,14,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,16,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,18,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,20,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(-9,22,0);
                    bouees2.add(bouee);
                });

            // PARTIE DROITE
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,22,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,20,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,18,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,16,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,14,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,12,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,10,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,8,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,6,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,4,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,2,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,0,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-2,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-4,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-6,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-8,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-10,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-12,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-14,0);
                    bouees2.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-16,0);
                    bouees4.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-18,0);
                    bouees1.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-20,0);
                    bouees3.add(bouee);
                });
                loader.load('../medias/models/Bouee.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    bouee = new THREE.Mesh( geometry, material );
                    bouee.name = "Bouee1";
                    bouee.scale.set(0.2,0.2,0.2);
                    bouee.rotation.x = Math.PI/2;
                    bouee.rotation.y = Math.PI/2;
                    bouee.position.set(9,-22,0);
                    bouees2.add(bouee);
                });

                /*scene.add(bouees1);
                scene.add(bouees2);
                scene.add(bouees3);
                scene.add(bouees4);*/


// Creation de l'effet d'eau
                var waterNormals = new THREE.ImageUtils.loadTexture('../medias/images/waternormals.jpg');
                waterNormals.wrapS = waterNormals.wrapT = THREE.RepeatWrapping; 
        
                var light = new THREE.PointLight(0xFFFFFF);
                light.position.set(30, 30, 30);

                ms_Water = new THREE.Water(renderer, camera, scene, {
                    textureWidth: 256,
                    textureHeight: 256,
                    waterNormals: waterNormals,
                    alpha:  0.95,
                    sunDirection: light.position.normalize(),
                    //sunColor: 0xfdb813,
                    sunColor: 0xfcd440,
                    waterColor: 0x006994,
                    betaVersion: 0,
                    side: THREE.DoubleSide
                });
                var aMeshMirror = new THREE.Mesh(
                    new THREE.PlaneBufferGeometry(2000, 2000, 10, 10), 
                    ms_Water.material
                );
                aMeshMirror.add(ms_Water);
                
               scene.add(aMeshMirror);


// Creation de la skybox
               var aCubeMap = THREE.ImageUtils.loadTextureCube([
                  '../medias/images/nx-afterEnd.jpg',
                  '../medias/images/px-afterEnd.jpg',
                  '../medias/images/pz-afterEnd.jpg',
                  '../medias/images/nz-afterEnd.jpg',
                  '../medias/images/py-afterEnd.jpg',
                  '../medias/images/ny-afterEnd.jpg'
                ]);
                aCubeMap.format = THREE.RGBFormat;

                var aShader = THREE.ShaderLib['cube'];
                aShader.uniforms['tCube'].value = aCubeMap;

                var aSkyBoxMaterial = new THREE.ShaderMaterial({
                  fragmentShader: aShader.fragmentShader,
                  vertexShader: aShader.vertexShader,
                  uniforms: aShader.uniforms,
                  depthWrite: false,
                  side: THREE.BackSide
                });

                var aSkybox = new THREE.Mesh(
                  new THREE.BoxGeometry(3000, 3000, 3000),
                  aSkyBoxMaterial
                );

                //aSkybox.rotation.z = -Math.PI * 0.5;
                aSkybox.position.z = 100;
                
                scene.add(aSkybox);
            }; // fin initGeometry


// Gestion Des Collisions//
            // Rays
            this.rays = [
                new THREE.Vector3(0, 0, 1),
                new THREE.Vector3(1, 0, 1),
                new THREE.Vector3(1, 0, 0),
                new THREE.Vector3(1, 0, -1),
                new THREE.Vector3(0, 0, -1),
                new THREE.Vector3(-1, 0, -1),
                new THREE.Vector3(-1, 0, 0),
                new THREE.Vector3(-1, 0, 1)
            ];
            this.ray = new THREE.Raycaster();

            function checkCollisionsPaddle(b, vec, objects) {
                this.ray.set(b.position.clone(), vec);
                var collResults = this.ray.intersectObjects(objects, true);
                if (collResults.length > 0 && collResults[0].distance < 1) {
                    var object = collResults[0].object;
                    console.log("Collision avec " + object.name);

                    if (object.name == "Player"){
                        if (toucheP == 0) {
                            setTimeout(function(){
                                directionY = directionY * -1;
                            }, 20);
                            cooldown = 1;
                            toucheP = 1;
                            coeffVitBall += 0.01;

                            var sound = new Howl({
                              urls: ['../medias/sounds/drum.wav']
                            }).play();

                            setTimeout(function(){
                                toucheP = 0;
                            }, 500);
                        }
                    }

                    if (object.name == "Enemy"){
                        if (toucheE == 0) {
                            setTimeout(function(){
                                directionY = directionY * -1;
                            }, 20);
                            cooldown = 1;
                            toucheE = 1;
                            toucheESuper = 1;
                            coeffVitBall += 0.01;

                            var sound = new Howl({
                              urls: ['../medias/sounds/drum.wav']
                            }).play();

                            setTimeout(function(){
                                toucheE = 0;
                            }, 500);

                            setTimeout(function(){
                                toucheESuper = 0;
                            }, 2000);
                        }
                    }

                    launch=1;
                    

                    return object;
                }
            };


// Calcul de distance
            function Distance(object1, object2) {
                    return Math.sqrt((object1.position.y - object2.position.y) * (object1.position.y - object2.position.y) + (object1.position.x - object2.position.x) * (object1.position.x - object2.position.x));
            }


// Music
            function music() {
                var music = new Howl({
                urls: ['../medias/music/music1.mp3'],
                autoplay: true,
                loop: false,
                volume: 0.3,
                buffer: true,
                onend: function() {
                    next();
                }
                });
            }

            function next() {
                var music = new Howl({
                urls: ['../medias/music/music4.mp3'],
                autoplay: true,
                loop: false,
                volume: 0.3,
                buffer: true
                });
            }

            function ajoutPaperBoat() {
                loader.load('../medias/models/paper_boat.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    paperboat = new THREE.Mesh( geometry, material );
                    paperboat.name = "Bateau Score";
                    paperboat.scale.set(0.7, 0.7, 0.7);
                    paperboat.rotation.x = Math.PI / 2;
                    paperboat.rotation.y = Math.PI / 2;
                    paperboat.position.set((10+5*scoreJoueur), -15, 0);
                    paperBoatScore.add(paperboat);
                    if (scoreJoueur == 1) {
                        paperBoatScoreLow.add(unSprite);
                        unSprite.scale.set(1.5,1.5,1.5);
                        unSprite.position.set(12,-15,2);
                    }
                    else {
                        paperBoatScoreLow.add(deuxSprite);
                        deuxSprite.scale.set(1.5,1.5,1.5);
                        deuxSprite.position.set(15,-15,2);
                    }
                    if (lowquality == "false") {
                        scene.add(paperBoatScore);
                    }
                    else {
                        scene.add(paperBoatScoreLow);
                    }
                });
            }

            function ajoutPaperBoatE() {
                loader.load('../medias/models/paper_boatE.json', function addModelToScene( geometry, materials) {
                    var material = new THREE.MeshFaceMaterial(materials);
                    paperboat = new THREE.Mesh( geometry, material );
                    paperboat.name = "Bateau Score";
                    paperboat.scale.set(0.7, 0.7, 0.7);
                    paperboat.rotation.x = Math.PI / 2;
                    paperboat.rotation.y = Math.PI / 2;
                    paperboat.position.set((10+5*scoreEnnemi), 15, 0);
                    paperBoatScore.add(paperboat);
                    if (scoreEnnemi == 1) {
                        paperBoatScoreLow.add(unSpriteE);
                        unSpriteE.scale.set(2.8,2.8,2.8);
                        unSpriteE.position.set(12,13,2);
                    }
                    else {
                        paperBoatScoreLow.add(deuxSpriteE);
                        deuxSpriteE.scale.set(2.8,2.8,2.8);
                        deuxSpriteE.position.set(15,13,2);
                    }
                    if (lowquality == "false") {
                        scene.add(paperBoatScore);
                    }
                    else {
                        scene.add(paperBoatScoreLow);
                    }
                });
            }

            function enleverPaperBoat() {
                scene.remove(paperBoatScore);
                for (var i = paperBoatScore.children.length - 1; i >= 0; i--) {
                    paperBoatScore.remove(paperBoatScore.children[i]);
                }
                scene.remove(paperBoatScoreLow);
                for (var i = paperBoatScoreLow.children.length - 1; i >= 0; i--) {
                    paperBoatScoreLow.remove(paperBoatScoreLow.children[i]);
                }
            }

            function gameOver() {
                var sound = new Howl({
                      urls: ['../medias/sounds/game_over-afterEnd.mp3'],
                      volume: 0.8
                    }).play();
                document.getElementById('defaite').innerHTML = "Vous avez perdu !";
                setTimeout(function(){
                    window.location.replace('classic.html');
                }, 10000);
            }


// Render
            function render() {
                houleZ += 0.01;
                houleX += 0.015;
                helico2.rotation.z += 0.2;
                helicoE2.rotation.z += 0.1;

                if (camHelico) {
                    camera.position.x = helico.position.x;
                    camera.position.y = helico.position.y - 3;
                    camera.position.z = helico.position.z + 3;
                    camera.rotation.x = 1.2;
                    camera.rotation.y = 0;
                    camera.rotation.z = 0;
                }

                if (camMouette) {
                    camera.position.x = Seagull.position.x;
                    camera.position.y = Seagull.position.y - 3;
                    camera.position.z = Seagull.position.z + 1.5;
                    camera.rotation.x = 1.2;
                    camera.rotation.y = 0;
                    camera.rotation.z = 0;
                }

                if (vueAerienne) {
                    camera.position.x = 0;
                    camera.position.y = 0;
                    camera.position.z = 60;
                    camera.rotation.x = 0;
                    camera.rotation.y = 0;
                    camera.rotation.z = 0;
                }

                if (run == 1 && launch == 0) {
                    BallMovX = Math.random() / 20;
                    if (BallMovX < 0.03) {BallMovX += 0.03};
                    BallMovY = -0.05; // la balle part vers le joueur

                    run = 0;
                    launch = 0;

                    setTimeout(function(){
                        Ball.material.opacity = 1;
                        outlineMesh1.material.opacity = 1;
                        outlineMesh2.material.opacity = 1;
                        outlineMesh3.material.opacity = 1;
                        outlineMesh4.material.opacity = 1;
                        outlineMesh5.material.opacity = 1;
                    }, 200);
                }

                outlineMesh1.position.x = Ball.position.x + BallMovX * directionX * -0.1;
                outlineMesh1.position.y = Ball.position.y + BallMovY * directionY * -0.1;
                outlineMesh1.position.z = Ball.position.z;

                outlineMesh2.position.x = Ball.position.x + BallMovX * directionX * -0.2;
                outlineMesh2.position.y = Ball.position.y + BallMovY * directionY * -0.2;
                outlineMesh2.position.z = Ball.position.z;

                outlineMesh3.position.x = Ball.position.x + BallMovX * directionX * -0.3;
                outlineMesh3.position.y = Ball.position.y + BallMovY * directionY * -0.3;
                outlineMesh3.position.z = Ball.position.z;

                outlineMesh4.position.x = Ball.position.x + BallMovX * directionX * -0.4;
                outlineMesh4.position.y = Ball.position.y + BallMovY * directionY * -0.4;
                outlineMesh4.position.z = Ball.position.z;

                outlineMesh5.position.x = Ball.position.x + BallMovX * directionX * -0.5;
                outlineMesh5.position.y = Ball.position.y + BallMovY * directionY * -0.5;
                outlineMesh5.position.z = Ball.position.z;

                BallposX = Ball.position.x;
                BallposY = Ball.position.y;

                
                particleSystemP.rotation.z += 0.1;
                particleSystemP.position.x = helico.position.x;
                particleSystemP.position.y = helico.position.y;

                particleSystemE.rotation.z += 0.1;
                if (lowquality == "false") {
                    particleSystemE.position.x = helicoE.position.x;
                    particleSystemE.position.y = helicoE.position.y;
                }
                else {
                    particleSystemE.position.x = ennemiSprite.position.x;
                    particleSystemE.position.y = ennemiSprite.position.y;
                }

                circleP.position.x = helico.position.x;
                circleP.position.y = helico.position.y;

                if (lowquality == "false") {
                    circleE.position.x = helicoE.position.x;
                    circleE.position.y = helicoE.position.y;
                }
                else {
                    circleE.position.x = ennemiSprite.position.x;
                    circleE.position.y = ennemiSprite.position.y;
                }



                if (Ball.position.y > 23) {
                    if (postProcess == false) {
                        var sound = new Howl({
                          urls: ['../medias/sounds/explosion.mp3'],
                          volume: 0.2
                        }).play();
                    }
                    postProcess = true;
                    scoreJoueur += 1;
                    if (scoreJoueur < 3){
                        changementManche = true;
                        gagnant = "Joueur";
                        ajoutPaperBoat();
                    }
                    else {
                        changementNiveau = true;
                        enleverPaperBoat();
                    }
                }

                if (Ball.position.y < -23) {
                    if (postProcess == false) {
                        var sound = new Howl({
                          urls: ['../medias/sounds/explosion.mp3'],
                          volume: 0.2
                        }).play();
                    }
                    postProcess = true;
                    if (invincible == false) {
                        scoreEnnemi += 1;
                        if (scoreEnnemi < 3){
                            changementManche = true;
                            gagnant = "Ennemi";
                            ajoutPaperBoatE();
                        }
                        else if (scoreEnnemi == 4) {
                            gameOver();
                            enleverPaperBoat();
                        }
                    }
                    else {
                        directionY = directionY * -1;
                    }
                }

                if (Ball.position.x > -6) {launch=1;}
                if (Ball.position.x > 8) {directionX = directionX * -1;}
                if (Ball.position.x < -8 && launch==1) {directionX = directionX * -1;}
                Ball.position.y += BallMovY * directionY * 2.5 * coeffVitBall;
                Ball.position.x += BallMovX * directionX * 2.5 * coeffVitBall;

                requestAnimationFrame(render);
                //controls.update();

                if (postProcess) {
                    composer.render(new THREE.Scene(), new THREE.PerspectiveCamera());
                    if (scoreEnnemi < 4 && scoreJoueur < 4) {
                        setTimeout(function(){
                            postProcess = false;
                        }, (700));
                    }
                }
                else {renderer.render(scene, camera);}


                checkCollisionsPaddle(Ball, rays, [circleP, circleE]);


                aiguilleX = (Ball.position.x - circleP.position.x)/Distance(circleP, Ball);
                aiguilleY = (Ball.position.y - circleP.position.y)/Distance(circleP, Ball);
                aiguille.position.x = circleP.position.x + 0.35 * aiguilleX;
                aiguille.position.y = circleP.position.y + 0.35 * aiguilleY;
                aiguille.scale.y = 1;
                if (Ball.position.x < helico.position.x) {aiguille.rotation.z = Math.acos(
                    (-(Ball.position.x - circleP.position.x)*(Ball.position.x - circleP.position.x) + (Ball.position.y - circleP.position.y)*(Ball.position.y - circleP.position.y) + Distance(circleP, Ball)*Distance(circleP, Ball))
                    / (2*(Ball.position.y - circleP.position.y)*Distance(circleP, Ball)));}
                else {aiguille.rotation.z = -1 * Math.acos(
                    (-(Ball.position.x - circleP.position.x)*(Ball.position.x - circleP.position.x) + (Ball.position.y - circleP.position.y)*(Ball.position.y - circleP.position.y) + Distance(circleP, Ball)*Distance(circleP, Ball))
                    / (2*(Ball.position.y - circleP.position.y)*Distance(circleP, Ball)));}
                if (Distance(circleP, Ball) > 0.7) {
                    if ((Ball.position.x - circleP.position.x) > 0) {
                        aiguille.position.x = circleP.position.x + 0.7 * aiguilleX * (1 - 1/(2*Distance(circleP, Ball)));
                    }
                    else {
                        aiguille.position.x = circleP.position.x + 0.7 * aiguilleX * (1 - 1/(2*Distance(circleP, Ball)));
                    }
                    if ((Ball.position.y - circleP.position.y) > 0) {
                        aiguille.position.y = circleP.position.y + 0.7 * aiguilleY * (1 - 1/(2*Distance(circleP, Ball)));
                    }
                    else {
                        aiguille.position.y = circleP.position.y + 0.7 * aiguilleY * (1 - 1/(2*Distance(circleP, Ball)));
                    }
                    
                    aiguille.scale.y = 1.5 * 0.7/(Distance(circleP, Ball));
                }

                if (toucheP == 1) {
                    if (inertie) {
                        if (cooldown == 1) {
                            if (directionX == -1) {BallMovX = -(Ball.position.x - circleP.position.x) / 10;}
                            if (directionX == 1) {BallMovX = (Ball.position.x - circleP.position.x) / 10;}
                            if (directionY == 1) {BallMovY = -(Ball.position.y - circleP.position.y) / 10;}
                            if (directionY == -1) {BallMovY = (Ball.position.y - circleP.position.y) / 10;}
                            cooldown = 0;
                        }
                    }
                    else {
                        if (cooldown == 1) {
                            if (directionX == -1) {BallMovX = -(Ball.position.x - circleP.position.x) / 13;}
                            if (directionX == 1) {BallMovX = (Ball.position.x - circleP.position.x) / 13;}
                            if (directionY == 1) {BallMovY = -(Ball.position.y - circleP.position.y) / 13;}
                            if (directionY == -1) {BallMovY = (Ball.position.y - circleP.position.y) / 13;}
                            cooldown = 0;
                        }
                    }
                }

                if (toucheE == 1) {
                    if (cooldown == 1) {
                        if (directionX == -1) {BallMovX = (-(Ball.position.x - circleE.position.x) / 13)*puissanceEnnemi;}
                        if (directionX == 1) {BallMovX = ((Ball.position.x - circleE.position.x) / 13)*puissanceEnnemi;}
                        if (directionY == 1) {BallMovY = -((Ball.position.y - circleE.position.y) / 13)*puissanceEnnemi;}
                        if (directionY == -1) {BallMovY = ((Ball.position.y - circleE.position.y) / 13)*puissanceEnnemi;}
                        cooldown = 0;
                    }
                }


// Gestion de la houle
                if( typeof pirate != "undefined" ){
                pirate.position.z += Math.sin(houleZ)/1500;
                pirate.rotation.x += Math.sin(houleX)/2000;
                pirate.rotation.z += Math.sin(houleZ)/4000;
                }

                if( typeof baseE != "undefined" ){
                baseE.position.z += Math.sin(houleZ)/2000;
                baseE.rotation.x += Math.sin(houleX)/2000;
                baseE.rotation.z += Math.sin(houleZ)/10000;
                }

                if( typeof baseP != "undefined" ){
                baseP.position.z += Math.sin(houleZ)/2000;
                baseP.rotation.y += Math.sin(houleX)/20000;
                baseP.rotation.z += Math.sin(houleZ)/50000;
                }

                if( typeof paperboat != "undefined" ){
                paperboat.position.z += Math.sin(houleZ)/2000;
                paperboat.rotation.z += Math.sin(houleZ)/2000;
                }if( typeof paperboatE != "undefined" ){
                paperboatE.position.z += Math.sin(houleZ)/-2000;
                paperboatE.rotation.y += Math.sin(houleX)/-500;
                paperboatE.rotation.z += Math.sin(houleZ)/-2000;
                }

                if (typeof bouees1 != "undefined"){
                    bouees1.rotation.z += Math.sin(houleZ)/10000;
                }
                if (typeof bouees2 != "undefined"){
                    bouees2.rotation.z += Math.sin(houleX)/10000;
                }
                if (typeof bouees3 != "undefined"){
                    bouees3.rotation.z += Math.sin(-houleX)/10000;
                }
                if (typeof bouees4 != "undefined"){
                    bouees4.rotation.z += Math.sin(-houleZ)/10000;
                }



// Deplacement helico
                if (bas == "true" && helico.position.y > -23) {
                    if (inertie) {
                        if (helico.rotation.x < 0.4) {
                            helico.rotation.x += 0.005;
                            if (helico.rotation.x > 0) {basI += 0.0125;}
                        };
                        helico.position.y += -0.1 * basI;
                    }
                    else {helico.position.y += -0.1;}
                };
                if (haut == "true" && helico.position.y < -6) {
                    if (inertie) {
                        if (helico.rotation.x > -0.4) {
                            helico.rotation.x += -0.005;
                            if (helico.rotation.x < 0) {hautI += 0.0125;}
                        };
                        helico.position.y += 0.1 * hautI;
                    }
                    else {helico.position.y += 0.1;}
                };
                if (gauche == "true" && helico.position.x > -8) {
                    if (inertie) {
                        if (helico.rotation.y > -0.4) {
                            helico.rotation.y += -0.005;
                            if (helico.rotation.y < 0) {gaucheI += 0.0125;}
                        };
                        helico.position.x += -0.1 * gaucheI;
                    }
                    else {helico.position.x += -0.1;}
                };
                if (droite == "true" && helico.position.x < 8) {
                    if (inertie) {
                        if (helico.rotation.y < 0.4) {
                            helico.rotation.y += 0.005;
                            if (helico.rotation.y > 0) {droiteI += 0.0125;}
                        };
                        helico.position.x += 0.1 * droiteI;
                    }
                    else {helico.position.x += 0.1;}
                };
                if (haut == "nul") {
                    if (inertie) {
                        if (helico.rotation.x < 0) {
                            helico.rotation.x += 0.01;
                            hautI -= 0.025;
                            if (helico.position.y < -6) {helico.position.y += 0.1 * hautI;}
                            if (helico.rotation.x > 0) {if (bas == "nul"){helico.rotation.x = 0;} hautI = 0;}
                        };
                    }
                };

                if (bas == "nul") {
                    if (inertie) {
                        if (helico.rotation.x > 0) {
                            helico.rotation.x += -0.01;
                            basI -= 0.025;
                            if (helico.position.y > -23) {helico.position.y += -0.1 * basI;}
                            if (helico.rotation.x < 0) {if (haut == "nul"){helico.rotation.x = 0;} basI = 0;}
                        };
                    }
                };

                if (gauche == "nul") {
                    if (inertie) {
                        if (helico.rotation.y < 0) {
                            helico.rotation.y += 0.01;
                            gaucheI -= 0.025;
                            if (helico.position.x > -8) {helico.position.x += -0.1 * gaucheI;}
                            if (helico.rotation.y > 0) {if (droite == "nul"){helico.rotation.y = 0;} gaucheI = 0;}
                        };
                    }
                }

                if (droite == "nul") {
                    if (inertie) {
                        if (helico.rotation.y > 0) {
                            helico.rotation.y += -0.01;
                            droiteI -= 0.025;
                            if (helico.position.x < 8) {helico.position.x += 0.1 * droiteI;}
                            if (helico.rotation.y < 0) {if (gauche == "nul"){helico.rotation.y = 0;} droiteI = 0;}
                        };
                    }
                };


// Deplacement Divers
                document.addEventListener( 'mousemove', onDocumentMouseMove, false );

                if( typeof Seagull != "undefined" ){
                    if (Seagull.position.x < (MouseX/20-35)){Seagull.position.x += 0.01; Seagull.rotation.y = -Math.PI/2;}
                    else if (Seagull.position.x > (MouseX/20-33)){Seagull.position.x -= 0.01; Seagull.rotation.y = Math.PI/2;};
                    Seagull.position.z += Math.sin(houleZ*10)/200;
                    Seagull.rotation.x += Math.sin(houleX*10)/200;
                    Seagull.rotation.z += Math.sin(houleZ*10)/500;
                    Seagull.rotation.y += Math.sin(houleX*10)/500;
                    if (Seagull.position.y < (-MouseY/20+7)){Seagull.position.y += 0.01; Seagull.rotation.y = Seagull.rotation.y/2;}
                    else if (Seagull.position.y > (-MouseY/20+9)){
                        Seagull.position.y -= 0.01;
                        Seagull.rotation.y = Math.PI;
                        if (Seagull.position.x < (MouseX/20-35)){Seagull.rotation.y = -3*Math.PI/4;};
                        if (Seagull.position.x > (MouseX/20-33)){Seagull.rotation.y = 3*Math.PI/4;};};
                    Seagull.position.z += Math.sin(houleZ*7)/250;
                    Seagull.rotation.x += Math.sin(houleX*7)/250;
                    Seagull.rotation.z += Math.sin(houleZ*7)/250;
                    Seagull.rotation.y += Math.sin(houleX*7)/250;
                };

                if( typeof Shark != "undefined" ){
                    Shark.position.z += Math.sin(houleZ)/2000;
                    Shark.rotation.x += Math.sin(houleX)/2000;
                    Shark.rotation.z += Math.sin(houleZ)/5000;
                    Shark.rotation.y += Math.sin(houleX)/5000;
                    Shark.position.x += 0.02;
                }


// IA helico ennemi
                if (lowquality == "true") {
                    if (niveau==1) {
                        if (ennemiSprite.position.x < (-6.6) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.x > (-6.4) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE;};

                        if (ennemiSprite.position.x < (Ball.position.x - 0.9) && launch==1 && ennemiSprite.position.x < 8){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.x > (Ball.position.x + 0.9) && launch==1 && ennemiSprite.position.x > -8){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE;};


                        if (ennemiSprite.position.y < (6.9) && launch==0){ennemiSprite.position.y = ennemiSprite.position.y + 0.06;}
                        else if (ennemiSprite.position.y > (7.1) && launch==0){ennemiSprite.position.y = ennemiSprite.position.y - 0.06;};

                        if ((ennemiSprite.position.y < (Ball.position.y - 0.9) || ((BallMovY*directionY>0) && ennemiSprite.position.y < (Ball.position.y + 5))) && launch==1 && ennemiSprite.position.y < 21){ennemiSprite.position.y = ennemiSprite.position.y + 0.06 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.y > (Ball.position.y + 0.9) && launch==1 && ennemiSprite.position.y > 6){ennemiSprite.position.y = ennemiSprite.position.y - 0.06 * coeffVitHelicoE;}
                    }
                    if (niveau==2) {
                        if (ennemiSprite.position.x < (-1) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.x > (1) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE;};

                        if (ennemiSprite.position.x < (Ball.position.x - 0.4) && launch==1 && ennemiSprite.position.x < 8 && toucheESuper!=1){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.x > (Ball.position.x + 0.4) && launch==1 && ennemiSprite.position.x > -8 && toucheESuper!=1){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE;};


                        if (ennemiSprite.position.y < (17.9) && launch==0){ennemiSprite.position.y = ennemiSprite.position.y + 0.06;}
                        else if (ennemiSprite.position.y > (18.1) && launch==0){ennemiSprite.position.y = ennemiSprite.position.y - 0.06;};

                        if ((ennemiSprite.position.y < (Ball.position.y - 0.4) || (BallMovY*directionY>0)) && launch==1 && ennemiSprite.position.y < 21 && toucheESuper!=1){ennemiSprite.position.y = ennemiSprite.position.y + 0.01 * coeffVitHelicoE;}
                        else if (ennemiSprite.position.y > (Ball.position.y + 0.4) && launch==1 && ennemiSprite.position.y > 6 && toucheESuper!=1){ennemiSprite.position.y = ennemiSprite.position.y - 0.06 * coeffVitHelicoE;};
                    }

                    if (niveau==3) {
                        // Replacement
                        if (ennemiSprite.position.x < (3.9) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE}
                        else if (ennemiSprite.position.x > (4.1) && launch==0){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE}
                        else if (ennemiSprite.position.y < (21) && launch==0){ennemiSprite.position.y = ennemiSprite.position.y + 0.06;}
                        // Charge
                        else if (ennemiSprite.position.x > (Ball.position.x - 2.3) && ennemiSprite.position.x < (Ball.position.x + 2.3) && ennemiSprite.position.y > Ball.position.y && Ball.position.y > 13 && (BallMovY*directionY>0) && launch==1 && ennemiSprite.position.y < 22){ennemiSprite.position.y = ennemiSprite.position.y - 0.31 * coeffVitHelicoE}
                        // Recule
                        else if (ennemiSprite.position.y < 21){ennemiSprite.position.y = ennemiSprite.position.y + 0.06 * coeffVitHelicoE}
                        // Droite
                        else if (ennemiSprite.position.x < (Ball.position.x - 1.3) && launch==1 && ennemiSprite.position.x < 7){ennemiSprite.position.x = ennemiSprite.position.x + 0.06 * coeffVitHelicoE}
                        // Gauche
                        else if (ennemiSprite.position.x > (Ball.position.x + 1.3) && launch==1 && ennemiSprite.position.x > -7){ennemiSprite.position.x = ennemiSprite.position.x - 0.06 * coeffVitHelicoE}
                    }
                }
                else {
                    if (niveau==1) {
                        if (helicoE.position.x < (-6.6) && launch==0){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE;}
                        else if (helicoE.position.x > (-6.4) && launch==0){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE;};

                        if (helicoE.position.x < (Ball.position.x - 0.9) && launch==1 && helicoE.position.x < 8){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE;}
                        else if (helicoE.position.x > (Ball.position.x + 0.9) && launch==1 && helicoE.position.x > -8){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE;};


                        if (helicoE.position.y < (6.9) && launch==0){helicoE.position.y = helicoE.position.y + 0.06;}
                        else if (helicoE.position.y > (7.1) && launch==0){helicoE.position.y = helicoE.position.y - 0.06;};

                        if ((helicoE.position.y < (Ball.position.y - 0.9) || ((BallMovY*directionY>0) && helicoE.position.y < (Ball.position.y + 5))) && launch==1 && helicoE.position.y < 21){helicoE.position.y = helicoE.position.y + 0.06 * coeffVitHelicoE;}
                        else if (helicoE.position.y > (Ball.position.y + 0.9) && launch==1 && helicoE.position.y > 6){helicoE.position.y = helicoE.position.y - 0.06 * coeffVitHelicoE;}
                    }
                    if (niveau==2) {
                        if (helicoE.position.x < (-1) && launch==0){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE;}
                        else if (helicoE.position.x > (1) && launch==0){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE;};

                        if (helicoE.position.x < (Ball.position.x - 0.4) && launch==1 && helicoE.position.x < 8 && toucheESuper!=1){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE;}
                        else if (helicoE.position.x > (Ball.position.x + 0.4) && launch==1 && helicoE.position.x > -8 && toucheESuper!=1){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE;};


                        if (helicoE.position.y < (17.9) && launch==0){helicoE.position.y = helicoE.position.y + 0.06;}
                        else if (helicoE.position.y > (18.1) && launch==0){helicoE.position.y = helicoE.position.y - 0.06;};

                        if ((helicoE.position.y < (Ball.position.y - 0.4) || (BallMovY*directionY>0)) && launch==1 && helicoE.position.y < 21 && toucheESuper!=1){helicoE.position.y = helicoE.position.y + 0.01 * coeffVitHelicoE;}
                        else if (helicoE.position.y > (Ball.position.y + 0.4) && launch==1 && helicoE.position.y > 6 && toucheESuper!=1){helicoE.position.y = helicoE.position.y - 0.06 * coeffVitHelicoE;};
                    }

                    if (niveau==3) {
                        // Replacement
                        if (helicoE.position.x < (3.9) && launch==0){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE; helicoE1.rotation.y = 0}
                        else if (helicoE.position.x > (4.1) && launch==0){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE; helicoE1.rotation.y = Math.PI}
                        else if (helicoE.position.y < (21) && launch==0){helicoE.position.y = helicoE.position.y + 0.06;}
                        // Charge
                        else if (helicoE.position.x > (Ball.position.x - 2.3) && helicoE.position.x < (Ball.position.x + 2.3) && helicoE.position.y > Ball.position.y && Ball.position.y > 13 && (BallMovY*directionY>0) && launch==1 && helicoE.position.y < 22){helicoE.position.y = helicoE.position.y - 0.31 * coeffVitHelicoE; helicoE1.rotation.y = -Math.PI/2;}
                        // Recule
                        else if (helicoE.position.y < 21){helicoE.position.y = helicoE.position.y + 0.06 * coeffVitHelicoE; helicoE1.rotation.y = Math.PI/2;}
                        // Droite
                        else if (helicoE.position.x < (Ball.position.x - 1.3) && launch==1 && helicoE.position.x < 7){helicoE.position.x = helicoE.position.x + 0.06 * coeffVitHelicoE; helicoE1.rotation.y = 0;}
                        // Gauche
                        else if (helicoE.position.x > (Ball.position.x + 1.3) && launch==1 && helicoE.position.x > -7){helicoE.position.x = helicoE.position.x - 0.06 * coeffVitHelicoE; helicoE1.rotation.y = Math.PI}
                        else {helicoE1.rotation.y = -Math.PI/2;}
                    }
                }


// Gestion Manches || Changement ennemi

// Changement Manche
                if (changementManche==true) {
                    Ball.material.opacity = 0;
                    outlineMesh1.material.opacity = 0;
                    outlineMesh2.material.opacity = 0;
                    outlineMesh3.material.opacity = 0;
                    outlineMesh4.material.opacity = 0;
                    outlineMesh5.material.opacity = 0;


                    BallMovX = 0;
                    BallMovY = 0;
                    directionY = 1;
                    coeffVitBall = 1;

                    Ball.position.set(-11.5, 0, 1);

                    launch = 0;

                    setTimeout(function(){
                        directionX = 1;
                        BallMovX = Math.random() / 20;
                        if (BallMovX < 0.025) {BallMovX += 0.025};

                        if (gagnant == "Joueur") {
                            BallMovY = 0.05;
                        }
                        else {
                            BallMovY = -0.05;
                        }

                        

                        setTimeout(function(){
                            Ball.material.opacity = 1;
                            outlineMesh1.material.opacity = 1;
                            outlineMesh2.material.opacity = 1;
                            outlineMesh3.material.opacity = 1;
                            outlineMesh4.material.opacity = 1;
                            outlineMesh5.material.opacity = 1;
                        }, 200);
                    }, 3000);

                    changementManche = false;
                }

// Changement Niveau
                if (niveau == 1 && changementNiveau == true) {
                    niveau = 2;

                    document.getElementById('messageLancement').innerHTML = 'GG WP !';

                    scene.remove(helicoE);
                    helicoE.remove(helicoE1);
                    helicoE.remove(helicoE2);
                    scene.remove(circleE);
                    scene.remove(particleSystemE);

                    Ball.material.opacity = 0;
                    outlineMesh1.material.opacity = 0;
                    outlineMesh2.material.opacity = 0;
                    outlineMesh3.material.opacity = 0;
                    outlineMesh4.material.opacity = 0;
                    outlineMesh5.material.opacity = 0;

                    BallMovX = 0;
                    BallMovY = 0;
                    directionY = 1;
                    coeffVitBall = 1.1;

                    scoreJoueur = 0;
                    scoreEnnemi = 0;

                    puissanceEnnemi = 1.5;

                    Ball.position.set(-11.5, 0, 1);

                    launch = 0;

                    setTimeout(function(){
                        coeffVitHelicoE = 3;
                        directionX = 1;
                        BallMovX = Math.random() / 20;
                        if (BallMovX < 0.025) {BallMovX += 0.025};
                        BallMovY = -0.05; // la balle part vers le joueur

                        setTimeout(function(){
                            Ball.material.opacity = 1;
                            outlineMesh1.material.opacity = 1;
                            outlineMesh2.material.opacity = 1;
                            outlineMesh3.material.opacity = 1;
                            outlineMesh4.material.opacity = 1;
                            outlineMesh5.material.opacity = 1;
                        }, 200);

// On recree helico et particules
                        setTimeout(function(){
                            var particleCount = 66;
                            var particles = new THREE.Geometry();
                            var particle_Material = new THREE.PointsMaterial({
                            color: 0x00ff00,
                            size: 0.2
                            });
                            var min = -10,
                            max = 10;
                            // Create the individual particles
                            for (var i = 0; i < particleCount; i++) {
                            var radius = 0.5;
                            var random = Math.random();
                            var variance = Math.random();
                            var max = 10,
                                min = -10;
                            //radius += (Math.floor(variance * (max - min + 1)) + min);
                            var pX = radius * Math.sin(random * (2 * Math.PI)),
                                pY = radius * Math.cos(random * (2 * Math.PI)),
                                pZ = 1;
                            var particle = new THREE.Vector3(
                                                pX,pY,pZ
                                            );
                            particle.velocity = new THREE.Vector3(
                                                    0,
                                                    -Math.random(),
                                                    0
                                                );
                            // Add the particle to the geometry
                            particles.vertices.push(particle);
                            }
                            // Create the particle system
                            particleSystemE = new THREE.Points(
                                                    particles,particle_Material
                                                );
                            particleSystemE.sortParticles = true;

                            particleSystemE.name = "PartyCules";
                            // Add the particle system to the scene
                            scene.add(particleSystemE);

                            var radius = 0.5,
                            segments = 64,
                            material = new THREE.LineBasicMaterial( { color: 0xff0000 } ),
                            geometry = new THREE.CircleGeometry( radius, segments );

                            // Remove center vertex
                            geometry.vertices.shift();
                            circleE = new THREE.Line( geometry, material );
                            circleE.position.z = 1;
                            circleE.name = "Enemy";

                            scene.add( circleE );
                        }, 2200);

                        loader.load('../medias/models/superman.json', function addModelToScene( geometry, materials) {
                        var material = new THREE.MeshFaceMaterial(materials);
                        helicoE1 = new THREE.Mesh( geometry, material );
                        helicoE1.name = "superman";
                        helicoE1.scale.set(0.4,0.4,0.4);
                        helicoE1.rotation.x = Math.PI/2;
                        helicoE1.position.set(0,0,0.4);
                        helicoE.add(helicoE1);
                        });

                        helicoE.position.set(-6,8,0);
                        if (lowquality == "false") {
                            scene.add(helicoE);
                        }
                    }, 6000);

                    changementNiveau = false;
                }

                if (niveau == 2 && changementNiveau == true) {
                    niveau = 3;

                    scene.remove(helicoE);
                    helicoE.remove(helicoE1);
                    helicoE.remove(helicoE2);
                    scene.remove(circleE);
                    scene.remove(particleSystemE);

                    Ball.material.opacity = 0;
                    outlineMesh1.material.opacity = 0;
                    outlineMesh2.material.opacity = 0;
                    outlineMesh3.material.opacity = 0;
                    outlineMesh4.material.opacity = 0;
                    outlineMesh5.material.opacity = 0;

                    BallMovX = 0;
                    BallMovY = 0;
                    directionY = 1;
                    coeffVitBall = 1;

                    scoreJoueur = 0;
                    scoreEnnemi = 0;

                    puissanceEnnemi = 1;

                    Ball.position.set(-11.5, 0, 1);

                    launch = 0;

                    setTimeout(function(){
                        coeffVitHelicoE = 0.8;
                        directionX = 1;
                        BallMovX = Math.random() / 20;
                        if (BallMovX < 0.025) {BallMovX += 0.025};
                        BallMovY = -0.05; // la balle part vers le joueur

                        setTimeout(function(){
                            Ball.material.opacity = 1;
                            outlineMesh1.material.opacity = 1;
                            outlineMesh2.material.opacity = 1;
                            outlineMesh3.material.opacity = 1;
                            outlineMesh4.material.opacity = 1;
                            outlineMesh5.material.opacity = 1;
                        }, 200);

// On recree helico et particules
                        var particleCount = 66;
                        var particles = new THREE.Geometry();
                        var particle_Material = new THREE.PointsMaterial({
                        color: 0xffffff,
                        size: 0.2
                        });
                        var min = -10,
                        max = 10;
                        // Create the individual particles
                        for (var i = 0; i < particleCount; i++) {
                        var radius = 2;
                        var random = Math.random();
                        var variance = Math.random();
                        var max = 10,
                            min = -10;
                        //radius += (Math.floor(variance * (max - min + 1)) + min);
                        var pX = radius * Math.sin(random * (2 * Math.PI)),
                            pY = radius * Math.cos(random * (2 * Math.PI)),
                            pZ = 1;
                        var particle = new THREE.Vector3(
                                            pX,pY,pZ
                                        );
                        particle.velocity = new THREE.Vector3(
                                                0,
                                                -Math.random(),
                                                0
                                            );
                        // Add the particle to the geometry
                        particles.vertices.push(particle);
                        }
                        // Create the particle system
                        particleSystemE = new THREE.Points(
                                                particles,particle_Material
                                            );
                        particleSystemE.sortParticles = true;

                        particleSystemE.name = "PartyCules";
                        // Add the particle system to the scene
                        scene.add(particleSystemE);

                        var radius = 2,
                        segments = 64,
                        material = new THREE.LineBasicMaterial( { color: 0x000000 } ),
                        geometry = new THREE.CircleGeometry( radius, segments );

                        // Remove center vertex
                        geometry.vertices.shift();
                        circleE = new THREE.Line( geometry, material );
                        circleE.position.z = 1;
                        circleE.name = "Enemy";

                        scene.add( circleE );

                        loader.load('../medias/models/godzilla.json', function addModelToScene( geometry, materials) {
                            var material = new THREE.MeshFaceMaterial(materials);
                            helicoE1 = new THREE.Mesh( geometry, material );
                            helicoE1.name = "godzilla";
                            helicoE1.scale.set(1.5,1.5,1.5);
                            helicoE1.rotation.x = Math.PI/2;
                            helicoE1.rotation.y = -Math.PI/2;
                            helicoE1.position.set(0,0,-1);
                            helicoE.add(helicoE1);
                        });

                        helicoE.position.set(0,18,0);

                        if (lowquality == "false") {
                            scene.add(helicoE);
                        }
                    }, 6000);

                    changementNiveau = false;
                }

                if (niveau == 3 && changementNiveau == true) {
                    niveau = "fin";

                    scene.remove(helicoE);
                    helicoE.remove(helicoE1);
                    scene.remove(circleE);
                    scene.remove(particleSystemE);
                    scene.remove(Ball);

                    Ball.material.opacity = 0;
                    outlineMesh1.material.opacity = 0;
                    outlineMesh2.material.opacity = 0;
                    outlineMesh3.material.opacity = 0;
                    outlineMesh4.material.opacity = 0;
                    outlineMesh5.material.opacity = 0;

                    BallMovX = 0;
                    BallMovY = 0;
                    directionY = 1;
                    coeffVitBall = 1;

                    scoreJoueur = 0;
                    scoreEnnemi = 0;

                    Ball.position.set(-11.5, 0, 1);

                    launch = 0;

                    changementNiveau = false;

                    var spriteMap = new THREE.TextureLoader().load("../medias/images/white-flag.png");
                    var spriteMaterial = new THREE.SpriteMaterial( { map: spriteMap, color: 0xffffff } );
                    drapeauSprite = new THREE.Sprite( spriteMaterial );
                    drapeauSprite.position.set(0,25,-7);
                    drapeauSprite.scale.set(10,10,10)
                    scene.add(drapeauSprite);

                    setTimeout(function(){
                        window.location.replace('classic-afterEnd.html');
                    }, 10000);
                }
                if (typeof drapeauSprite != "undefined") {
                        drapeauSprite.position.z = drapeauSprite.position.z + 0.015;
                }


// Changement de la qualite du jeu
                if (lowquality == "true" && changequality == true) {
                    scene.add(options);
                    scene.add(paperBoatScore);
                    barresBut.position.z -= 0.1;
                    boueesAlt.position.z -= 0.1;
                    helicoE.position.x = ennemiSprite.position.x;
                    helicoE.position.y = ennemiSprite.position.y;
                    scene.add(helicoE);
                    pirateSprite.position.x += -1000;
                    ennemiSprite.position.x += -1000;
                    paperBoatScoreLow.position.x += -1000;
                    changequality = false;
                    lowquality = "false";
                }
                if (lowquality == "false" && changequality == true){
                    scene.remove(options);
                    scene.remove(paperBoatScore);
                    barresBut.position.z += 0.1;
                    boueesAlt.position.z += 0.1;
                    ennemiSprite.position.x = helicoE.position.x;
                    ennemiSprite.position.y = helicoE.position.y;
                    ennemiSprite.position.z = helicoE.position.z + 2;
                    scene.remove(helicoE);
                    pirateSprite.position.x += 1000;
                    scene.add(paperBoatScoreLow);
                    paperBoatScoreLow.position.x += 1000;
                    changequality = false;
                    lowquality = "true";
                }

                if (lowquality == "true") {
                    if (vueAerienne == true) {
                        pirateSprite.position.y = 0;
                        unSprite.scale.set(2.8,2.8,2.8);
                        deuxSprite.scale.set(2.8,2.8,2.8);
                        unSpriteE.position.y = 15;
                        deuxSpriteE.position.y = 15;
                    }
                    else {
                        pirateSprite.position.y = -1;
                        unSprite.scale.set(1.5,1.5,1.5);
                        deuxSprite.scale.set(1.5,1.5,1.5);
                        unSpriteE.position.y = 13;
                        deuxSpriteE.position.y = 13;
                    }
                }

                if (bouees == "false" && changeBouees == true) {
                    scene.add(bouees1);
                    scene.add(bouees2);
                    scene.add(bouees3);
                    scene.add(bouees4);
                    changeBouees = false;
                    bouees = "true";
                    scene.remove(boueesAlt);
                }
                if (bouees == "true" && changeBouees == true) {
                    scene.remove(bouees1);
                    scene.remove(bouees2);
                    scene.remove(bouees3);
                    scene.remove(bouees4);
                    changeBouees = false;
                    bouees = "false";
                    scene.add(boueesAlt);
                }

// Gestion rendu mer
                ms_Water.render();

                ms_Water.material.uniforms.time.value += 1.0 / 300;

                
                var thisLoop = new Date;
                fps = 1000 / (thisLoop - lastLoop);
                lastLoop = thisLoop;

                setTimeout(function(){
                    if (fps > 50 &&  document.getElementById('intro').innerHTML !== '') {
                        document.getElementById('lancerNavalPong').removeAttribute("disabled");
                        document.getElementById('lancerClassicPong').removeAttribute("disabled");
                    }
                }, 2000);
            }// fin render

            function onDocumentMouseMove( event ) 
            {
                MouseX = event.clientX;
                MouseY = event.clientY;
            }

            // Deplacements
            window.addEventListener("keydown", checkKeyPressed, false);
            function checkKeyPressed(e) {
                if (e.keyCode == "90") { // Z
                    haut = "true";
                }
                if (e.keyCode == "83") { // S
                    bas = "true";
                }
                if (e.keyCode == "81") { // Q
                    gauche = "true";
                }
                if (e.keyCode == "68") { // D
                    droite = "true";
                }

            }
            ;
            window.addEventListener("keyup", checkKeyReleased, false);
            function checkKeyReleased(e) {
                if (e.keyCode == "90") { // Z
                    haut = "nul";
                }
                if (e.keyCode == "83") { // S
                    bas = "nul";
                }
                if (e.keyCode == "81") { // Q
                    gauche = "nul";
                }
                if (e.keyCode == "68") { // D
                    droite = "nul";
                }
                if (e.keyCode == "76") { // L
                    run = 1;
                    document.getElementById('messageLancement').innerHTML = '';
                }
                if (e.keyCode == "80") { // P
                    window.open( renderer.domElement.toDataURL("image/png"), "Final");
                }
                if (e.keyCode == "70") { // F
                    if (pleinEcran) {THREEx.FullScreen.cancel(); pleinEcran = false;}
                    else {THREEx.FullScreen.request(); pleinEcran = true;}
                }

                if (e.keyCode == "89") { // Y
                    changequality = true;
                }
                if (e.keyCode == "85") { // U
                    changeBouees = true;
                }
                if (e.keyCode == "17") { // CTRL
                    if (inertie == true) {inertie = false}
                    else {inertie = true};
                }
                
                if (e.keyCode == "96" || e.keyCode == "48") { // 0 
                    camera.position.x = 0;
                    camera.position.y = -36;
                    camera.position.z = 15;
                    camera.rotation.x = 1.05;
                    camera.rotation.y = 0;
                    camera.rotation.z = 0;
                    camHelico = false;
                    camMouette = false;
                    vueAerienne = false;
                }

                if (e.keyCode == "97" || e.keyCode == "49") { // 1
                    if (vueAerienne == true) {
                        vueAerienne = false;
                        camera.position.x = 0;
                        camera.position.y = -36;
                        camera.position.z = 15;
                        camera.rotation.x = 1.05;
                        camera.rotation.y = 0;
                        camera.rotation.z = 0;}
                    else {camHelico = false; camMouette = false; vueAerienne = true};
                }

                if (e.keyCode == "98" || e.keyCode == "50") { // 2
                    if (camHelico == true) {
                        camHelico = false;
                        camera.position.x = 0;
                        camera.position.y = -36;
                        camera.position.z = 15;
                        camera.rotation.x = 1.05;
                        camera.rotation.y = 0;
                        camera.rotation.z = 0;
                    }
                    else {camMouette = false; camHelico = true; vueAerienne = false};
                }

                if (e.keyCode == "99" || e.keyCode == "51") { // 3
                    if (camMouette == true) {
                        camMouette = false;
                        camera.position.x = 0;
                        camera.position.y = -36;
                        camera.position.z = 15;
                        camera.rotation.x = 1.05;
                        camera.rotation.y = 0;
                        camera.rotation.z = 0;
                    }
                    else {camHelico = false; camMouette = true; vueAerienne = false};
                }

                if (e.keyCode == "77") { // M
                    if (mute == false) {mute=true;Howler.mute();document.getElementById('mute').innerHTML = 'UnMute';}else {mute=false;Howler.unmute();document.getElementById('mute').innerHTML = 'Mute';}
                }

                if (e.keyCode == "72") { // H
                    window.alert("Déplacez votre hélicoptère avec les touches zqsd :\n   - z : en avant\n   - q : à gauche\n   - s : en arrière\n   - d : à droite\nLe but est de toucher la balle (tirée du bateau pirate) avec le cercle situé sous votre hélicoptère.\n\nGagnez 3 manches pour passer au niveau suivant mais attention ! L'ennemi risque de vous surprendre plus d'une fois !\n\nLes touches à connaitre :\n   - control : changer l'inertie de votre hélicoptère (+mobile -puissant)\n   - 0 : placer la caméra par défaut\n   - 1 : placer la caméra en vue de dessus\n   - 2 : placer la caméra au niveau de l'hélicoptère\n   - 3 : placer la caméra au niveau de la mouette\n   - y : changer la qualité graphique du jeu\n   - u : ajouter/supprimer de jolies bouées\n\nVous pouvez aussi tricher comme kij vous sedile && utmdizea =\n   - ° ! asdi mcpujr ykd nsuehc\n   _ ² . worf scmpnabule\n   ] µ ; pciee\nPAS DE PLACE POUR LES TRICHEURS ICI\n\nEt ni pour les Jokers non plus ..");
                }
            }

// Lancement
            initScene();
            initLight();
            initGeometry();
            // Initialisation camera
            camera.position.y = -36;
            camera.position.z = 15;
            camera.rotation.x = 1.05;
            render();
        </script>
        </div>
    </body>
</html>